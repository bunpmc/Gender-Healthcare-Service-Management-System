<app-header />

<main
  class="min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-indigo-50"
>
  <div class="max-w-7xl mx-auto px-6 py-8">
    <!-- ================== LOADING STATE ================== -->
    @if (isLoading()) {
    <div class="flex justify-center items-center py-20">
      <div
        class="animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500"
      ></div>
    </div>
    }

    <!-- ================== ERROR STATE ================== -->
    @if (error()) {
    <div
      class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6"
    >
      {{ error() }}
    </div>
    }

    <!-- ================== MAIN CONTENT ================== -->
    @if (!isLoading()) {

    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-gray-800 mb-2">Period Tracking</h1>
      <p class="text-gray-600 text-lg">
        Track your menstrual cycle and get insights
      </p>
    </div>

    <!-- Tab Navigation -->
    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 mb-8">
      <div class="flex overflow-x-auto">
        <button
          (click)="switchTab('overview')"
          [class]="
            'flex-1 px-6 py-4 text-center font-medium transition-all duration-200 ' +
            (activeTab() === 'overview'
              ? 'bg-pink-500 text-white rounded-l-2xl'
              : 'text-gray-600 hover:text-pink-500 hover:bg-pink-50')
          "
        >
          <div class="flex items-center justify-center space-x-2">
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
              ></path>
            </svg>
            <span>Overview</span>
          </div>
        </button>

        <button
          (click)="switchTab('calendar')"
          [class]="
            'flex-1 px-6 py-4 text-center font-medium transition-all duration-200 ' +
            (activeTab() === 'calendar'
              ? 'bg-pink-500 text-white'
              : 'text-gray-600 hover:text-pink-500 hover:bg-pink-50')
          "
        >
          <div class="flex items-center justify-center space-x-2">
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
              ></path>
            </svg>
            <span>Calendar</span>
          </div>
        </button>

        <button
          (click)="switchTab('insights')"
          [class]="
            'flex-1 px-6 py-4 text-center font-medium transition-all duration-200 ' +
            (activeTab() === 'insights'
              ? 'bg-pink-500 text-white'
              : 'text-gray-600 hover:text-pink-500 hover:bg-pink-50')
          "
        >
          <div class="flex items-center justify-center space-x-2">
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"
              ></path>
            </svg>
            <span>Insights</span>
          </div>
        </button>

        <button
          (click)="switchTab('history')"
          [class]="
            'flex-1 px-6 py-4 text-center font-medium transition-all duration-200 ' +
            (activeTab() === 'history'
              ? 'bg-pink-500 text-white rounded-r-2xl'
              : 'text-gray-600 hover:text-pink-500 hover:bg-pink-50')
          "
        >
          <div class="flex items-center justify-center space-x-2">
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              ></path>
            </svg>
            <span>History</span>
          </div>
        </button>
      </div>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Overview Tab -->
      @if (activeTab() === 'overview') {
      <div class="tab-pane">
        <!-- Check if user has any real period data (not sample data) -->
        @if (periodHistory().length === 0 ||
        periodHistory()[0].period_id.includes('sample')) {

        <!-- ================== WELCOME / ONBOARDING ================== -->
        <div class="max-w-7xl mx-auto">
          <!-- Welcome Card -->
          <div
            class="bg-white rounded-3xl p-8 shadow-xl border border-gray-100 text-center"
          >
            <div
              class="w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-6"
            >
              <svg
                class="w-10 h-10 text-white"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                ></path>
              </svg>
            </div>

            <h2 class="text-2xl font-bold text-gray-800 mb-4">
              Welcome to Period Tracking
            </h2>
            <p class="text-gray-600 mb-8 leading-relaxed">
              Start tracking your menstrual cycle to get personalized insights,
              predictions, and health recommendations. Your data is private and
              secure.
            </p>

            <!-- Get Started Button -->
            <button
              (click)="openLogForm()"
              class="bg-gradient-to-r from-pink-500 to-purple-600 text-white px-8 py-4 rounded-2xl font-semibold text-lg hover:from-pink-600 hover:to-purple-700 transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl"
            >
              <svg
                class="w-5 h-5 inline-block mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 6v6m0 0v6m0-6h6m-6 0H6"
                ></path>
              </svg>
              Log Your First Period
            </button>

            <!-- Benefits -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-12">
              <div class="text-center">
                <div
                  class="w-12 h-12 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-3"
                >
                  <svg
                    class="w-6 h-6 text-pink-500"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                    ></path>
                  </svg>
                </div>
                <h3 class="font-semibold text-gray-800 mb-2">Track Patterns</h3>
                <p class="text-sm text-gray-600">
                  Monitor your cycle length, symptoms, and flow intensity
                </p>
              </div>

              <div class="text-center">
                <div
                  class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3"
                >
                  <svg
                    class="w-6 h-6 text-purple-500"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M13 10V3L4 14h7v7l9-11h-7z"
                    ></path>
                  </svg>
                </div>
                <h3 class="font-semibold text-gray-800 mb-2">
                  Get Predictions
                </h3>
                <p class="text-sm text-gray-600">
                  Predict your next period and fertile window
                </p>
              </div>

              <div class="text-center">
                <div
                  class="w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-3"
                >
                  <svg
                    class="w-6 h-6 text-indigo-500"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
                    ></path>
                  </svg>
                </div>
                <h3 class="font-semibold text-gray-800 mb-2">
                  Health Insights
                </h3>
                <p class="text-sm text-gray-600">
                  Understand your body and improve your wellness
                </p>
              </div>
            </div>
          </div>
        </div>

        } @else {

        <!-- ================== DASHBOARD WITH DATA ================== -->
        <div class="max-w-7xl mx-auto">
          <!-- Current Status Card -->
          <div
            class="bg-white rounded-3xl p-8 shadow-xl border border-gray-100 mb-8"
          >
            <div class="text-center">
              <h2 class="text-2xl font-bold text-gray-800 mb-6">
                Your Cycle Overview
              </h2>

              <!-- Ongoing Period Alert -->
              @if (getOngoingPeriodInfo(); as ongoingInfo) {
              <div
                class="mb-6 bg-gradient-to-r from-red-50 to-pink-50 border border-red-200 rounded-2xl p-4 shadow-sm"
              >
                <div class="flex items-center justify-between">
                  <div class="flex items-center space-x-3">
                    <div
                      class="w-3 h-3 bg-red-500 rounded-full animate-pulse"
                    ></div>
                    <div>
                      <h3 class="text-lg font-semibold text-red-800">
                        Ongoing Period
                      </h3>
                      <p class="text-red-700">
                        Day {{ ongoingInfo.dayCount }} â€¢ Started
                        {{ formatDate(ongoingInfo.startDate) }}
                      </p>
                    </div>
                  </div>
                  <button
                    (click)="editCurrentPeriod()"
                    class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-xl text-sm font-medium transition-colors duration-200 flex items-center space-x-2 shadow-md"
                  >
                    <svg
                      class="w-4 h-4"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                      ></path>
                    </svg>
                    <span>Edit Period</span>
                  </button>
                </div>
              </div>
              }

              <!-- Enhanced Fertility Analysis -->
              @if (periodStats(); as stats) {
              <div class="mb-8">
                <!-- Period Status Alert -->
                @if (stats.periodStatus?.isLate) {
                <div
                  class="mb-4 bg-gradient-to-r from-red-50 to-orange-50 border border-red-300 rounded-2xl p-4 shadow-sm"
                >
                  <div class="flex items-center space-x-3">
                    <div
                      class="w-4 h-4 bg-red-500 rounded-full animate-pulse"
                    ></div>
                    <div>
                      <h3 class="text-lg font-semibold text-red-800">
                        Period is {{ stats.periodStatus?.daysLate }} days late
                      </h3>
                      <p class="text-red-700 text-sm">
                        Expected:
                        {{ formatDate(stats.periodStatus?.expectedDate || "") }}
                        @if (stats.periodStatus?.shouldTestPregnancy) { â€¢
                        Consider taking a pregnancy test }
                      </p>
                      <div class="mt-2">
                        <p class="text-xs text-red-600 font-medium">
                          Possible reasons:
                        </p>
                        <ul class="text-xs text-red-600 list-disc list-inside">
                          @for (reason of
                          stats.periodStatus?.possibleReasons?.slice(0, 3) ||
                          []; track reason) {
                          <li>{{ reason }}</li>
                          }
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
                }

                <!-- Fertility Analysis Card -->
                <div
                  class="bg-gradient-to-br from-emerald-50 to-green-50 border border-emerald-200 rounded-2xl p-6 shadow-sm mb-4"
                >
                  <h3
                    class="text-xl font-bold text-emerald-800 mb-4 flex items-center"
                  >
                    <span
                      class="w-6 h-6 bg-emerald-500 rounded-full mr-3 flex items-center justify-center"
                    >
                      <span class="text-white text-sm">ðŸŒ±</span>
                    </span>
                    Fertility Analysis
                  </h3>

                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Current Phase -->
                    <div>
                      <h4 class="font-semibold text-emerald-700 mb-2">
                        Current Phase
                      </h4>
                      <div
                        class="bg-white rounded-xl p-4 border border-emerald-100"
                      >
                        <div
                          class="text-2xl font-bold text-emerald-600 capitalize"
                        >
                          {{
                            stats.fertilityAnalysis?.currentPhase || "Unknown"
                          }}
                        </div>
                        <p class="text-sm text-gray-600 mt-1">
                          {{
                            stats.fertilityAnalysis?.phaseDescription ||
                              "No data available"
                          }}
                        </p>
                        <div class="mt-3">
                          <div
                            class="flex items-center justify-between text-xs text-gray-500 mb-1"
                          >
                            <span>Fertility Score</span>
                            <span
                              >{{
                                stats.fertilityAnalysis?.fertilityScore || 0
                              }}%</span
                            >
                          </div>
                          <div class="w-full bg-gray-200 rounded-full h-2">
                            <div
                              class="h-2 rounded-full transition-all duration-300"
                              [class]="{
                                'bg-emerald-500':
                                  (stats.fertilityAnalysis?.fertilityScore ||
                                    0) >= 80,
                                'bg-green-500':
                                  (stats.fertilityAnalysis?.fertilityScore ||
                                    0) >= 60 &&
                                  (stats.fertilityAnalysis?.fertilityScore ||
                                    0) < 80,
                                'bg-yellow-500':
                                  (stats.fertilityAnalysis?.fertilityScore ||
                                    0) >= 40 &&
                                  (stats.fertilityAnalysis?.fertilityScore ||
                                    0) < 60,
                                'bg-orange-500':
                                  (stats.fertilityAnalysis?.fertilityScore ||
                                    0) >= 20 &&
                                  (stats.fertilityAnalysis?.fertilityScore ||
                                    0) < 40,
                                'bg-red-500':
                                  (stats.fertilityAnalysis?.fertilityScore ||
                                    0) < 20
                              }"
                              [style.width.%]="
                                stats.fertilityAnalysis?.fertilityScore || 0
                              "
                            ></div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Conception Timing -->
                    <div>
                      <h4 class="font-semibold text-emerald-700 mb-2">
                        Conception Timing
                      </h4>
                      <div
                        class="bg-white rounded-xl p-4 border border-emerald-100"
                      >
                        <div
                          class="text-lg font-bold text-orange-600 capitalize mb-2"
                        >
                          {{
                            stats.conceptionTiming?.chanceOfConception?.replace(
                              "_",
                              " "
                            ) || "Unknown"
                          }}
                          Chance
                        </div>
                        <div class="text-sm text-gray-600 mb-3">
                          Optimal window:
                          {{
                            formatDate(
                              stats.conceptionTiming?.optimalWindow?.start || ""
                            )
                          }}
                          -
                          {{
                            formatDate(
                              stats.conceptionTiming?.optimalWindow?.end || ""
                            )
                          }}
                        </div>
                        <div class="space-y-1">
                          @for (action of
                          stats.conceptionTiming?.recommendedActions?.slice(0,
                          2) || []; track action) {
                          <div class="text-xs text-gray-600 flex items-start">
                            <span class="text-emerald-500 mr-1">â€¢</span>
                            {{ action }}
                          </div>
                          }
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              }

              <!-- Simple Stats Grid -->
              <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Current Cycle Day -->
                <div
                  class="bg-gradient-to-br from-pink-50 to-pink-100 rounded-2xl p-8"
                >
                  <div class="text-3xl font-bold text-pink-600 mb-2">
                    Day {{ currentCycleDay }}
                  </div>
                  <div class="text-sm text-gray-600">of your current cycle</div>
                  <div class="text-xs text-gray-500 mt-1">
                    Average: {{ averageCycleLength }} days
                  </div>
                </div>

                <!-- Next Period -->
                <div
                  class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl p-8"
                >
                  <div class="text-lg font-bold text-purple-600 mb-2">
                    @if (periodStats()) {
                    {{ formatDate(periodStats()!.nextPeriodDate) }}
                    } @else { Calculating... }
                  </div>
                  <div class="text-sm text-gray-600">Next period expected</div>
                  <div class="text-xs text-gray-500 mt-1">
                    @if (periodStats()) {
                    {{ periodStats()!.daysUntilNextPeriod }} days to go } @else
                    { - }
                  </div>
                </div>

                <!-- Period Length -->
                <div
                  class="bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-2xl p-8"
                >
                  <div class="text-3xl font-bold text-indigo-600 mb-2">
                    {{ getPeriodLength() }}
                  </div>
                  <div class="text-sm text-gray-600">Average period length</div>
                  <div class="text-xs text-gray-500 mt-1">
                    {{ getStreakDays() }} cycles tracked
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Actions and History -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
            <!-- Quick Actions -->
            <div
              class="bg-white rounded-3xl p-8 shadow-xl border border-gray-100"
            >
              <h3 class="text-xl font-semibold text-gray-800 mb-6">
                Quick Actions
              </h3>

              <div class="space-y-6">
                <!-- Log New Period -->
                <button
                  (click)="openLogForm()"
                  class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white p-5 rounded-2xl font-semibold hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center justify-center group text-lg"
                >
                  <svg
                    class="w-5 h-5 mr-3 group-hover:scale-110 transition-transform"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 6v6m0 0v6m0-6h6m-6 0H6"
                    ></path>
                  </svg>
                  Log New Period
                </button>

                <!-- View Calendar -->
                <button
                  (click)="showCalendar.set(!showCalendar())"
                  class="w-full bg-gray-100 text-gray-700 p-5 rounded-2xl font-semibold hover:bg-gray-200 transition-all duration-300 flex items-center justify-center group text-lg"
                >
                  <svg
                    class="w-5 h-5 mr-3 group-hover:scale-110 transition-transform"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                    ></path>
                  </svg>
                  {{ showCalendar() ? "Hide" : "View" }} Calendar
                </button>
              </div>
            </div>

            <!-- Recent Periods -->
            <div
              class="bg-white rounded-3xl p-8 shadow-xl border border-gray-100"
            >
              <h3 class="text-xl font-semibold text-gray-800 mb-6">
                Recent Periods
              </h3>

              @if (periodHistory().length > 0) {
              <div class="space-y-6">
                @for (period of periodHistory().slice(0, 3); track
                period.period_id) {
                <div class="bg-gray-50 rounded-xl p-6">
                  <div class="flex justify-between items-start">
                    <div>
                      <p class="font-medium text-gray-800">
                        {{ formatDate(period.start_date) }}
                        @if (period.cycle_length) {
                        <span class="text-gray-600 ml-2">
                          ({{ period.cycle_length }} day cycle)
                        </span>
                        } @else {
                        <span class="text-red-600 font-semibold ml-2">
                          (Ongoing)
                        </span>
                        }
                      </p>
                      <p class="text-sm text-gray-600 mt-1">
                        Flow: {{ period.flow_intensity }} @if (period.symptoms
                        && period.symptoms.length > 0) { â€¢
                        {{ period.symptoms.length }} symptoms }
                      </p>
                    </div>
                    @if (!period.cycle_length) {
                    <button
                      (click)="editCurrentPeriod()"
                      class="bg-red-500 hover:bg-red-600 text-white px-3 py-1.5 rounded-lg text-xs font-medium transition-colors duration-200 flex items-center space-x-1"
                    >
                      <svg
                        class="w-3 h-3"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                        ></path>
                      </svg>
                      <span>Edit</span>
                    </button>
                    }
                  </div>
                </div>
                }
              </div>
              } @else {
              <p class="text-gray-500 text-center py-8">
                No periods logged yet
              </p>
              }
            </div>
          </div>
        </div>
        }
      </div>
      }

      <!-- Calendar Tab -->
      @if (activeTab() === 'calendar') {
      <div class="tab-pane">
        <div class="bg-white rounded-3xl p-8 shadow-xl border border-gray-100">
          <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">
              Period Calendar
            </h2>
            <p class="text-gray-600">
              Track your cycle with a beautiful Flo-style calendar
            </p>
          </div>

          <!-- Flo-style Calendar Component -->
          <app-period-calendar
            [periodHistory]="periodHistory()"
            [periodStats]="periodStats()"
            [currentMonth]="currentMonth"
            (daySelected)="onCalendarDayClick($event)"
            (monthChanged)="onMonthChanged($event)"
          ></app-period-calendar>

          <!-- Quick Actions -->
          <div class="mt-8 flex justify-center space-x-4">
            <button
              (click)="toggleLogForm()"
              class="bg-gradient-to-r from-pink-500 to-pink-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-pink-600 hover:to-pink-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1"
            >
              <div class="flex items-center space-x-2">
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 6v6m0 0v6m0-6h6m-6 0H6"
                  ></path>
                </svg>
                <span>Log Period</span>
              </div>
            </button>

            <button
              (click)="switchTab('insights')"
              class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-purple-600 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1"
            >
              <div class="flex items-center space-x-2">
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"
                  ></path>
                </svg>
                <span>View Insights</span>
              </div>
            </button>
          </div>
        </div>
      </div>
      }

      <!-- Insights Tab -->
      @if (activeTab() === 'insights') {
      <div class="tab-pane">
        <div class="space-y-8">
          <!-- Cycle Insights -->
          <div
            class="bg-white rounded-3xl p-8 shadow-xl border border-gray-100"
          >
            <h2 class="text-2xl font-bold text-gray-800 mb-6">
              Cycle Insights
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
              <!-- Cycle Length Trend -->
              <div
                class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-6"
              >
                <h3 class="text-lg font-semibold text-blue-800 mb-4">
                  Cycle Length
                </h3>
                <div class="text-3xl font-bold text-blue-600 mb-2">
                  {{ averageCycleLength }} days
                </div>
                <p class="text-sm text-blue-700">Average cycle length</p>
                <div class="mt-4 text-xs text-blue-600">
                  Range: {{ getMinCycleLength() }}-{{ getMaxCycleLength() }}
                  days
                </div>
              </div>

              <!-- Period Length -->
              <div
                class="bg-gradient-to-br from-green-50 to-green-100 rounded-2xl p-6"
              >
                <h3 class="text-lg font-semibold text-green-800 mb-4">
                  Period Length
                </h3>
                <div class="text-3xl font-bold text-green-600 mb-2">
                  {{ getPeriodLength() }} days
                </div>
                <p class="text-sm text-green-700">Average period length</p>
                <div class="mt-4 text-xs text-green-600">
                  Based on {{ getStreakDays() }} cycles
                </div>
              </div>
            </div>
          </div>

          <!-- Symptoms Analysis -->
          <div
            class="bg-white rounded-3xl p-8 shadow-xl border border-gray-100"
          >
            <h2 class="text-2xl font-bold text-gray-800 mb-6">
              Symptoms Analysis
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              @for (symptom of getTopSymptoms(); track symptom.name) {
              <div class="bg-gray-50 rounded-xl p-4">
                <h4 class="font-semibold text-gray-800 mb-2">
                  {{ symptom.name }}
                </h4>
                <div class="text-2xl font-bold text-pink-600 mb-1">
                  {{ symptom.frequency }}%
                </div>
                <p class="text-sm text-gray-600">of cycles</p>
              </div>
              }
            </div>
          </div>
        </div>
      </div>
      }

      <!-- History Tab -->
      @if (activeTab() === 'history') {
      <div class="tab-pane">
        <div class="bg-white rounded-3xl p-8 shadow-xl border border-gray-100">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">Period History</h2>

          @if (periodHistory().length > 0) {
          <div class="space-y-6">
            @for (period of periodHistory(); track period.period_id) {
            <div
              class="border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow"
            >
              <div class="flex justify-between items-start mb-4">
                <div>
                  <h3 class="text-lg font-semibold text-gray-800">
                    {{ formatDate(period.start_date) }}
                    @if (period.cycle_length) {
                    <span class="text-gray-600 ml-2">
                      ({{ period.cycle_length }} day cycle)
                    </span>
                    } @else {
                    <span class="text-red-600 font-semibold ml-2">
                      (Ongoing)
                    </span>
                    }
                  </h3>
                  <p class="text-sm text-gray-600">
                    Duration: {{ getPeriodDuration(period) }} days
                  </p>
                </div>
                <div class="text-right">
                  <span
                    class="inline-block px-3 py-1 rounded-full text-sm font-medium"
                    [class]="{
                      'bg-red-100 text-red-800':
                        period.flow_intensity === 'heavy',
                      'bg-orange-100 text-orange-800':
                        period.flow_intensity === 'medium',
                      'bg-yellow-100 text-yellow-800':
                        period.flow_intensity === 'light'
                    }"
                  >
                    {{ period.flow_intensity }} flow
                  </span>
                </div>
              </div>

              @if (period.symptoms && period.symptoms.length > 0) {
              <div class="mt-4">
                <h4 class="text-sm font-medium text-gray-700 mb-2">
                  Symptoms:
                </h4>
                <div class="flex flex-wrap gap-2">
                  @for (symptom of period.symptoms; track symptom) {
                  <span
                    class="px-2 py-1 bg-gray-100 text-gray-700 rounded-lg text-xs"
                  >
                    {{ getSymptomDisplayName(symptom) }}
                  </span>
                  }
                </div>
              </div>
              } @if (period.period_description) {
              <div class="mt-4">
                <h4 class="text-sm font-medium text-gray-700 mb-2">Notes:</h4>
                <p class="text-sm text-gray-600">
                  {{ period.period_description }}
                </p>
              </div>
              }
            </div>
            }
          </div>
          } @else {
          <div class="text-center py-12">
            <svg
              class="w-16 h-16 text-gray-300 mx-auto mb-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
              ></path>
            </svg>
            <h3 class="text-lg font-medium text-gray-900 mb-2">
              No period history yet
            </h3>
            <p class="text-gray-500 mb-6">
              Start logging your periods to see your history here
            </p>
            <button
              (click)="toggleLogForm()"
              class="bg-pink-500 text-white px-6 py-3 rounded-xl font-semibold hover:bg-pink-600 transition-colors"
            >
              Log Your First Period
            </button>
          </div>
          }
        </div>
      </div>
      }
    </div>
    }

    <!-- ================== LOG PERIOD MODAL ================== -->
    @if (showLogForm()) {
    <div
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
    >
      <div
        class="bg-white rounded-3xl p-8 w-full max-w-7xl max-h-[90vh] overflow-y-auto"
      >
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Log Period Data</h2>
          <div class="flex items-center space-x-3">
            <!-- Show Calendar Button -->
            <button
              type="button"
              (click)="toggleMiniCalendar()"
              class="flex items-center px-4 py-2 bg-purple-100 text-purple-700 hover:bg-purple-200 rounded-lg transition-colors"
            >
              <svg
                class="w-4 h-4 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                ></path>
              </svg>
              {{ showMiniCalendar() ? "Hide Calendar" : "Show Calendar" }}
            </button>
            <button
              (click)="showLogForm.set(false)"
              class="text-gray-500 hover:text-gray-700 text-2xl"
            >
              Ã—
            </button>
          </div>
        </div>

        <!-- Mini Calendar Display -->
        @if (showMiniCalendar()) {
        <div class="mb-6 bg-gray-50 rounded-xl p-4">
          <h3
            class="text-lg font-semibold text-gray-800 mb-4 flex items-center"
          >
            <svg
              class="w-5 h-5 mr-2 text-purple-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
              ></path>
            </svg>
            Period Calendar
          </h3>
          <div class="mini-calendar-container overflow-hidden">
            <div class="transform scale-75 origin-top-left -mb-16">
              <app-period-calendar
                [periodHistory]="periodHistory()"
                [periodStats]="periodStats()"
                [miniMode]="true"
              ></app-period-calendar>
            </div>
          </div>
        </div>
        }

        <form (ngSubmit)="savePeriodData()" class="period-log-form space-y-6">
          <!-- Start Date -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <svg
                class="w-4 h-4 inline-block mr-1 text-pink-500"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                ></path>
              </svg>
              Period Start Date *
            </label>
            <div class="relative">
              <input
                type="date"
                [(ngModel)]="logForm.start_date"
                name="start_date"
                required
                [max]="getTodayDateString()"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition-colors text-gray-700 bg-white"
                placeholder="Select start date"
              />
              <div
                class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"
              >
                <svg
                  class="w-5 h-5 text-gray-400"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                  ></path>
                </svg>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-1">
              When did your period start? (Default: Today)
            </p>
          </div>

          <!-- Cycle Length -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <svg
                class="w-4 h-4 inline-block mr-1 text-purple-500"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                ></path>
              </svg>
              Cycle Length (days)
            </label>
            <div class="relative">
              <input
                type="number"
                [(ngModel)]="logForm.cycle_length"
                name="cycle_length"
                min="21"
                max="35"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-colors text-gray-700 bg-white"
                placeholder="28"
              />
              <div
                class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"
              >
                <svg
                  class="w-5 h-5 text-gray-400"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"
                  ></path>
                </svg>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-1">
              Average days between periods (21-35 days)
            </p>
          </div>

          <!-- Period Length -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <svg
                class="w-4 h-4 inline-block mr-1 text-red-500"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                ></path>
              </svg>
              Period Length (days)
            </label>
            <div class="relative">
              <input
                type="number"
                [(ngModel)]="logForm.period_length"
                name="period_length"
                min="1"
                max="10"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-colors text-gray-700 bg-white"
                placeholder="5"
              />
              <div
                class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"
              >
                <svg
                  class="w-5 h-5 text-gray-400"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                  ></path>
                </svg>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-1">
              How long your period will last (1-10 days)
            </p>
          </div>

          <!-- Flow Intensity -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Flow Intensity *
            </label>
            <select
              [(ngModel)]="logForm.flow_intensity"
              name="flow_intensity"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500"
            >
              <option value="">Select intensity</option>
              <option value="light">Light</option>
              <option value="medium">Medium</option>
              <option value="heavy">Heavy</option>
              <option value="very_heavy">Very Heavy</option>
            </select>
          </div>

          <!-- Symptoms -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Symptoms (optional)
            </label>
            <div class="grid grid-cols-2 gap-2">
              @for (symptom of PERIOD_SYMPTOMS.slice(0, 6); track symptom) {
              <label class="flex items-center">
                <input
                  type="checkbox"
                  [checked]="isSymptomSelected(symptom)"
                  (change)="toggleSymptom(symptom)"
                  class="mr-2"
                />
                {{ getSymptomDisplayName(symptom) }}
              </label>
              }
            </div>
          </div>

          <!-- Description -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Notes (optional)
            </label>
            <textarea
              [(ngModel)]="logForm.period_description"
              name="period_description"
              rows="3"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500"
              placeholder="Any additional notes..."
            ></textarea>
          </div>

          <!-- Cycle Length Validation Error -->
          @if (logForm.cycle_length && (logForm.cycle_length < 21 ||
          logForm.cycle_length > 35)) {
          <div class="bg-red-50 border border-red-200 rounded-lg p-3">
            <div class="flex items-center">
              <svg
                class="w-4 h-4 text-red-500 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                ></path>
              </svg>
              <p class="text-sm text-red-700">
                Cycle length must be between 21 and 35 days
              </p>
            </div>
          </div>
          }

          <!-- Period Length Validation Error -->
          @if (logForm.period_length && (logForm.period_length < 1 ||
          logForm.period_length > 10)) {
          <div class="bg-red-50 border border-red-200 rounded-lg p-3">
            <div class="flex items-center">
              <svg
                class="w-4 h-4 text-red-500 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                ></path>
              </svg>
              <p class="text-sm text-red-700">
                Period length must be between 1 and 10 days
              </p>
            </div>
          </div>
          }

          <!-- Submit Button -->
          <div class="flex space-x-3 pt-4">
            <button
              type="button"
              (click)="showLogForm.set(false)"
              class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium"
            >
              Cancel
            </button>
            <button
              type="submit"
              [disabled]="
                isLoading() ||
                !logForm.start_date ||
                !logForm.flow_intensity ||
                (logForm.cycle_length &&
                  (logForm.cycle_length < 21 || logForm.cycle_length > 35)) ||
                (logForm.period_length &&
                  (logForm.period_length < 1 || logForm.period_length > 10))
              "
              class="flex-1 px-4 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed font-medium"
            >
              @if (isLoading()) {
              <svg
                class="animate-spin -ml-1 mr-2 h-4 w-4 text-white inline-block"
                fill="none"
                viewBox="0 0 24 24"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                ></circle>
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
              </svg>
              Saving... } @else {
              <svg
                class="w-4 h-4 inline-block mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M5 13l4 4L19 7"
                ></path>
              </svg>
              Save Period }
            </button>
          </div>
        </form>
      </div>
    </div>
    }

    <!-- ================== SUCCESS MODAL WITH PREDICTIONS ================== -->
    @if (showSuccessModal()) {
    <div
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
    >
      <div
        class="bg-white rounded-3xl p-8 w-full max-w-lg max-h-[90vh] overflow-y-auto"
      >
        <!-- Success Header -->
        <div class="text-center mb-6">
          <div
            class="w-16 h-16 bg-gradient-to-br from-green-400 to-green-500 rounded-full flex items-center justify-center mx-auto mb-4"
          >
            <svg
              class="w-8 h-8 text-white"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5 13l4 4L19 7"
              ></path>
            </svg>
          </div>
          <h2 class="text-2xl font-bold text-gray-800 mb-2">
            Period Logged Successfully!
          </h2>
          @if (successPredictions()?.isFirstPeriod) {
          <p class="text-gray-600">
            Welcome to period tracking! Here are your initial predictions based
            on average cycle data
          </p>
          } @else {
          <p class="text-gray-600">
            Here are your personalized predictions based on your cycle data
          </p>
          }
        </div>

        @if (successPredictions()) {
        <!-- Predictions Grid -->
        <div class="space-y-4 mb-6">
          <!-- Next Period -->
          <div
            class="bg-gradient-to-r from-pink-50 to-pink-100 rounded-2xl p-4"
          >
            <div class="flex items-center mb-2">
              <svg
                class="w-5 h-5 text-pink-500 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                ></path>
              </svg>
              <h3 class="font-semibold text-gray-800">Next Period</h3>
            </div>
            <p class="text-lg font-bold text-pink-600">
              {{ successPredictions()!.nextPeriodDate }}
            </p>
            <p class="text-sm text-gray-600">
              {{ successPredictions()!.daysUntilNextPeriod }} days from now
            </p>
          </div>

          <!-- Fertile Window -->
          <div
            class="bg-gradient-to-r from-green-50 to-green-100 rounded-2xl p-4"
          >
            <div class="flex items-center mb-2">
              <svg
                class="w-5 h-5 text-green-500 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
                ></path>
              </svg>
              <h3 class="font-semibold text-gray-800">Fertile Window</h3>
            </div>
            <p class="text-sm text-gray-700">
              {{ successPredictions()!.fertileWindow.start }} -
              {{ successPredictions()!.fertileWindow.end }}
            </p>
            <p class="text-xs text-gray-500 mt-1">
              Most likely time to conceive
            </p>
          </div>

          <!-- Ovulation -->
          <div
            class="bg-gradient-to-r from-yellow-50 to-yellow-100 rounded-2xl p-4"
          >
            <div class="flex items-center mb-2">
              <svg
                class="w-5 h-5 text-yellow-500 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
                ></path>
              </svg>
              <h3 class="font-semibold text-gray-800">Estimated Ovulation</h3>
            </div>
            <p class="text-lg font-bold text-yellow-600">
              {{ successPredictions()!.ovulationDate }}
            </p>
            <p class="text-xs text-gray-500">Peak fertility day</p>
          </div>

          <!-- Cycle Stats -->
          <div
            class="bg-gradient-to-r from-purple-50 to-purple-100 rounded-2xl p-4"
          >
            <div class="flex items-center mb-2">
              <svg
                class="w-5 h-5 text-purple-500 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                ></path>
              </svg>
              <h3 class="font-semibold text-gray-800">Your Cycle Stats</h3>
            </div>
            <div class="grid grid-cols-2 gap-4 text-sm">
              <div>
                <p class="text-purple-600 font-bold">
                  {{ successPredictions()!.averageCycleLength }} days
                </p>
                <p class="text-gray-500">Average cycle</p>
              </div>
              <div>
                <p class="text-purple-600 font-bold">
                  {{ successPredictions()!.periodLength }} days
                </p>
                <p class="text-gray-500">Period length</p>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-2">
              Based on {{ successPredictions()!.totalCyclesTracked }} cycles
              tracked
            </p>
          </div>

          <!-- First Period Disclaimer -->
          @if (successPredictions()?.isFirstPeriod) {
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
            <div class="flex items-start">
              <svg
                class="w-4 h-4 text-blue-500 mr-2 mt-0.5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                ></path>
              </svg>
              <div>
                <p class="text-sm text-blue-700 font-medium">
                  First Period Logged!
                </p>
                <p class="text-xs text-blue-600 mt-1">
                  These predictions are based on average cycle data. They'll
                  become more accurate as you log more periods.
                </p>
              </div>
            </div>
          </div>
          }
        </div>
        }

        <!-- Action Buttons -->
        <div class="flex space-x-3">
          <button
            (click)="showSuccessModal.set(false)"
            class="flex-1 px-4 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 font-medium"
          >
            <svg
              class="w-4 h-4 inline-block mr-2"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5 13l4 4L19 7"
              ></path>
            </svg>
            Got it!
          </button>
        </div>
      </div>
    </div>
    }
  </div>
</main>

<app-footer />
